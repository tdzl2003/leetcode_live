[比赛链接](https://atcoder.jp/contests/abc309/tasks)

## A

简单题，注意不要读错题，题目要求是水平相连

所以先判断在同一行，然后判断仅相差1 即可。

## B

简单题，按题意模拟即可。

这类旋转题，可以暴力写4个循环，而不用过多思考。

## C

从差分角度思考。第一天所有药都必须吃。之后第 $a_i+1$ 天，吃的药减少 $b_i$ 。

所以可以直接将药按 $a_i$ 排序，先求出总和，然后按 $a_i$ 的顺序减少 $b_i$ 直到当前药量小于 $k$ 了，就返回 $a_i+1$ 即可。

## D

原图分为两个部分，在两个部分之间增加一条边。

那么增加之后，这条边显然是从 $1$ 到 $N_1+N_2$ 的必经之路。所以该路径的长度，就等于 $1$ 到这条边的一个端点的距离，加上 $N_1+N_2$ 到另一个端点的距离，再加1 。

所以分别对原图的两个部分求距离 $1$ 和 $N_1+N_2$ 的最远点，即为答案。

## E

简单题

可以直接求出每个人自己买的保险最大覆盖了多少多少代的后代 $A_i$ ，然后在树上DP：

$$
DP_i = max(A_i, DP_{p_i} - 1)
$$

注意到本题有 $p_i \lt i$ ，因此按下标顺序遍历即可。

## F

证明题。

首先证明，若A能装进B中，将A的三个维度分别排序，也能装进B中。因为若有：

$$
i,j \in {1,2,3} \\
i\gt j \\
A_i \gt A_j , B_i \lt B_j \\
A_i \lt B_i , A_j \lt B_j \\
$$

则有

$$
A_j\lt A_i \lt B_i \\
A_i \lt B_j \lt B_j \\
$$

因此交换 $A_j, A_i$ 依然能够放入。

所以将每个盒子自己的三个坐标排序，然后：

* 按 $h_i$ 从大到小顺序排序所有盒子，保证已经处理过的盒子 $h_i$ 都更大。
* 以 $w_i$ 顺序从大到小构建线段树/树状数组。在其中保存最大的 $d_i$ 
* 在线段树/树状数组中查找 $w_j$ 比当前盒子更大的范围中，最大的 $d_j$ 。如果有 $d_j>d_i$ ，此时盒子可以放入。

注意上述过程在一个边界情况存在问题：

* $h_i$ 相同的盒子中，可能有 $w_i$ 和 $d_i$ 均更大的盒子出现，此时其实无法放入。

为了规避此问题，我们排序时按 $(h_i, -w_i)$ 从大到小排序（即 $h_i$ 相同时， $w_i$ 从小到大），这样就可以保证相同的 $h_i$ 没有出现过更大的 $w_i$

## G

### 我的解法

考虑使用DP解决此题。

设 $DP[i][mask][k]$ ：

* $i$ 表示前 $i$ 个位置的组合
* $mask$ 使用 $2X+1$ 位二进制掩码表示当前位置，以及前后各 $X-1$ 个位置的状态。
* $k$ 表示掩码右侧的范围，有多少个数已经被选择。

基础思路是：之前的任意位置，对于掩码右侧的范围，都是等概率的选择。因此当剩下的 $N-i-X$ 个位置中有 $k$ 已经被选择时，第 $i+X$ 个数（掩码范围右侧的第一个数）被选择的概率（或组合占比）即为 $\frac{k}{N-i-X}$ 。

为了方便处理，引入辅助函数 $next[i][mask][k]$ 表示当前第i个数已经被选择过的状态，分两步递推：

从 $DP[i][mask][k]$ 到 $next[i][mask][k']$ 

* 设 $j=bitcount(mask)$ 
* 考虑从mask范围的前面取。如果要取，必须满足 $i>=X$，并且前面还要有数未被选择。
    * 已选择的数总共为 $i-1$ 个， 所以前面的可选数量为 $(i-X) - (i-1-j-k) = j+k-X+1$ 个位置。
    * $k' = k$ 
* 要从mask范围的后面取，必须满足 $i+X\lt N$ ，并且后面有空
    * 后面总计有 $N-i-X$ 个位置，所以可选位置为 $N-i-X-k$ 个。
    * $k' = k+1$

从 $next[i][mask][k]$ 到 $DP[i][mask'][k']$  

* 首先如果mask范围已经越过了N，单独处理，$mask' = mask <<1 \bmod 2^{2X+1}$
* 否则，可以从后面吃掉一个数 或吃掉一个空：
    * 令 $total = N-i-X$ 为mask右侧所有数的数量。
    * 当 $k\gt 1$ 时，可以吃掉一个数。其分布占比为 $\frac{k}{total}$
    * 当 $k\lt total$ 时，可以吃掉一个空，其分布占比为 $\frac{total-k}{total}$

综上，递推过程均为 $O(1)$ ，时间复杂度为状态数量 $O(N^24^X)$

### 官解

