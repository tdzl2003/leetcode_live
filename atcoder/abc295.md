[比赛链接](https://atcoder.jp/contests/abc295)

## A

简单题，按题意实现即可

## B

简单题，按题意实现暴力枚举即可

## C

简单题，对相同的数字计数并贪心配对即可；也可排序后连续计数。

## D

其实是问多少个连续区段中，所有数字的个数都是偶数。

连续区段计数问题考虑前缀和，这里用二进制的十个位表示每个数字出现的奇偶性，那么出现重复的状态的时候，意味着这两个状态之间的区段满足条件。


## E

我赛中的思路：

枚举目标数 i，然后考虑未知数中，比i小的有a个，比i大的有c个，和i相等的有b个
根据已知数中比i小的和比i大的数目可以推出a和c的上界。

然后其组合数公式列出来这样：

$$
\sum_a\sum_c \frac{zc!}{a!c!b!} (i-1)^a(M-i)^c
$$

该公式可以拆成包含a的部分、包含c的部分分别计算，然后卷积，再加入剩下的部分求和。复杂度 $O(MNlgN)$ 。

题解的思路：

要求的是 $X=A_k$ 的期望：

$$
E(X) = \sum_{i=1}^M(i*P(X=i)) = \sum_{i=1}^MP(X\ge i)
$$

这个计算起来更加容易，相比起思路1的公式，它不必拆分等于或大于$i$ 的情况。

所以可以直接枚举比 $i$ 小的未知数个数，在 $O(NM)$ 时间内完成。

## F

首先框架思路，有 $\sum_{i=L}^Rf(X) = \sum_{i=0}^Rf(X) - \sum_{i=0}^{L-1}f(X)$ 。

然后考虑如何求解 $\sum_{i=0}^Rf(X)$ 。这里可以用数位DP，然而还有更简单的做法。

举例如 $S=45$ 考虑 $S$ 出现在每一位上的所有整数（举例如百位上），按顺序排列如下：

* 4500, 4501, .. 4599
* 14500, 14501, ... 14599

因此第 $i$ 大的这类数可以用 $i$ 的前后两部分中间插入S组成。我们可采用二分查找查找使得构造的整数 $\le R$ 的最大的 $i$ 。

## G

题目约束了连接的边 $u,v$ 一定存在一条从v到u的边，那么很显然只存在两种情况：

1. v一开始是u的祖先
2. 存在某个u的祖先r，v可以到达r

可以证明，一旦增加一条边，该边上经过的所有点都会处于同一个强连通块。并且任意一个强连通块中所有点的最近公共祖先在该强连通块中（否则总是无法制造存在一条在两个不同子树之间的边）。

然后可以证明，连接时，v一定可以到达u和v的最近公共祖先。因为从它们的任何一个公共祖先都可以到达最近公共祖先。

考虑并查集做法：

* 连接u，v时，找到u和v的公共祖先r
* 将u到r之间的每一个点都加入并查集相同的集合
* 要查询时，查找x所在集合中深度最低的点，它即为所能到达的编号最小的点。

但是该做法时间复杂度不过关，因此考虑进一步利用本题中集合的性质进行优化范围合并的过程：

1. 若u和r已经处在一个集合，结束
2. 直接找到u所在集合的根p，它是u的祖先，并且因为u和r不在一个集合，所以它也和u不在一个集合
3. 将p和p的父亲合并。
4. 回到1，继续。

在这样的过程下，每个点至多和自己的父亲合并一次，并且合并过程中的每次查询必然合并一次，因此确保总复杂度不超过 $O(N+Q)$ 