[题目链接](https://atcoder.jp/contests/abc332/tasks)

## A

简单题。按题意计算并输出即可。

## B

简单题，按题意模拟即可。

想要更低复杂度的计算出此题，需要进行一些计算：

首先需要注意到首先两个瓶子里的水，永远都是 两个瓶子容量的最大公约数的倍数。
然后注意必然存在一个周期，且周期结束时 两个瓶子恰好再次为空。

设 $x = GCD(G, M)$ 。则有 $ G=ax; M=bx $ 且 $a, b, x$ 均为整数。

显然整个周期 $M$ 装满了 $a$ 次而 $G$ 装满了 $b$ 次。

周期中间没有两个瓶子恰好都为空的时候，所以周期中的每次3类操作 或者紧跟一个1类操作， 或者紧跟一个2类操作，除了周期的最后一次1类操作没有跟随3类操作。所以总计一个周期是 $a$ 次2类操作、$b$ 次1类操作、 $a+b-1$ 次3类操作。可以首先将 $K$ 对周期长度取余，结果不变。

然后显然第偶数次操作是3类操作，且第三类操作不改变两个瓶子中水量之和。如果我们知道水量之和：

* 在三类操作之前，要么瓶1满，要么瓶2空。如果水量大于 $M$ ，则瓶1满，剩余水在瓶2。 否则瓶2空，所有水在瓶1.
* 在三类操作之后，要么瓶2满，要么瓶1空。如果水量大于 $G$ ，则瓶2满，剩余水在瓶1。 否则瓶1空，所有水在瓶2。

所以两次操作为一组操作，我们想要求出 $k=\lceil\frac{K}{2}\rceil$ 组操作之后，两个瓶子水量之和。

每组操作对于水量的改变规则如下：

* 如果总水量小于G，则增加M（2类操作）
* 否则总水量减去G（1类操作）

所以剩余水量为 $iM-jG$ 且满足： $i+j=k$ 并且 $0\lt iM-jG \lt G+M$

代入得到 

$$
0\le iM - (k-i)G < G+M \\
0\le i(G+M)-kG \lt G+M \\
kG \le i(G+M) \lt (k+1)G+M \\
i = \lceil\frac{kG}{G+M}\rceil
$$

因此可以求解。算法复杂度主要为GCD的 $O(lg(min(G,M)))$

## C

因为每次0 都重置所有状态，所以只需要求出最大的连续非0区段 需要多少logo T恤、需要多少总计T恤，然后取最大的需求数量即可。

## D

首先暴力可解，复杂度 $H!\times W! \times HW$ 完全在时限范围之内。遍历所有的排列，能够匹配上的作为候选解。

想要代码简单点，考虑使用 `std::next_permutation` ，这样直接写个四重循环，而无需递归。

考虑一层复杂度的优化：对其中一个维度枚举（譬如枚举列的顺序），另一个维度可以采用hash表的方法来检测行和行之间的对应关系。这样可以做到 $H!\times HW$  的时间复杂度（已经可以支撑到 $10\times 10$ 或者是 $5\times 10000$ 这样的规模了）。

## E 

将公式变形：

$$
\frac{1}{D}\sum_{i=1}^D(x_i-\overline{x})^2 =\\
\frac{1}{D}((\sum_{i=1}^Dx_i^2) - 2\overline{x}(\sum_{i=1}^Dx_i)+D\overline{x}^2) = \\
\frac{1}{D}((\sum_{i=1}^Dx_i^2) - D\overline{x}^2) =\
\overline{x_i^2} - \overline{x_i}^2
$$

这实际上就是“离散型随机变量方差计算公式” $D(X) = E(X^2)-E^2(X)$的推导过程。

所以我们在推导各项公式时，可以分别统计所有数的和 以及 平方和，就可以推算出方差。

对于本题来说，$E^2(X)$显然是不变的，所以我们只考虑前半部分尽量的小。

因此一个很直接的想法是进行二进制状压DP，数据范围也完全支持这种想法。

最后需要注意精度问题，在double下进行两个大数的相减很容易丢失精度，必须要在整数域做好减法（整体乘以 $D^2$ 做运算），最后一起除以 $D^2$ 才能保证相对精度。

## F

首先，每一个位置的期望是独立的：对于每一个包含该位置的操作，有 $\frac{1}{R_i-L_i+1}$ 的几率改变该位置的值，所以该位置的期望变为 

$$
E' = \frac{(R_i-L_i)E + X_i}{R_i-L_i+1}
$$

> 注意这里有一个模除过程，但除数不会超过 $N$ 。希望你了解 $O(N)$ 计算出所有 $N$ 以内数逆元的方法。

如果把 $F(x) = ax+b$ 表示成二元组 $\lt a, b\gt$ ，那么有

$$
F(x) = ax+b \\
G(x) = cx+d \\
F·G(x) = F(G(x)) = acx + (ad+b) = \lt ac,ad+b \gt
$$

因此直接套用延迟线段树就可以解决本题。注意 $F·G$ 不满足交换律，因此一定需要注意计算顺序。

当然，这类虽然做了区段修改，但是仅仅做了单点查询的问题 往往可以转变为普通线段树求解。本题的一种可行做法如下：

* 采用线段树维护所有活跃的操作。合并规则即为上文所述函数合并规则。初始所有操作都为 $E=\lt 1,0\gt$ 。
* 按下标顺序遍历。在区段开始时，将操作设置为对应的函数。区段结束时，将操作还原成 $E$ 。
* 与此同时对线段树求 `all_prod` ，即为当前下标涉及到的所有操作的合并结果。


## G

首先这题显然可以作为一个网络流问题来构造解法：

* 为每个球和每个盒子建顶点。
* 起点到每个颜色的球的流量为该类球的数量 $A_i$
* 每个盒子到终点的流量为该盒子的容量 $B_j$
* 每个球到每个盒子的流量为该类球在该盒子中的最大数量，即为 $i\times j$

但是本题 $M$ 的超大范围显然不能直接用网络流求解（二分图 dinic 网络流复杂度为 $O(E\sqrt{V})$。本题中 $E$ 是 $2.5\times 10^8$ 规模，$V$ 是 $5\times 10^5$ 规模。

本题的巧妙之处在于逆向运用最小割等于最大流的定理，将最大流问题反向变形成最小割问题。

考虑该图的一组最小割的割边构成：

* 一部分被选中的球，边权为 $A_i$
* 一部分被选中的盒子，边权为 $B_j$ 
* 剩下所有的球和盒子之间的所有边，边权为 $i\times j$

我们把后两部分边合并考虑，显然我们可以选择 $min(B_j, \sum_{i \notin S}{i}\times j)$ 。显然选择哪个取决于 $\frac{B_j}{j}$ 和 $_{i \notin S}{i}$ 的大小关系。因为后者是个整数，我们可以对前者取整，并且相等时总是优先选后者。

所以我们按 $\lfloor\frac{B_j}{j}\rfloor$ 排序之后，就可以在均摊 $O(1)$ 的时间知道对于每个不同的 $\sum_{i \notin S}{i}$， $\sum_{j}min(B_j, \sum_{i \notin S}{i}\times j)$ 的最小值是多少。

然后我们就可以对球进行DP解决此题：$DP[a][b]$ 表示前 $a$ 个球中，$b=\sum_{i \notin S}{i}$ 的最小的 $\sum_{i\in S}{A_i}$。该DP具有 $O(N^3)$ 的状态和 $O(1)$ 的转移，对本题来说足以通过。
