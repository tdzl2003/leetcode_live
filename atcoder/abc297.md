[比赛链接](https://atcoder.jp/contests/abc297/tasks)

## A

简单题，按题意遍历直到找到为止即可。

## B

简单题，按题意做好判断即可。

## C

简单贪心题，每行处理按顺序对连续的T进行贪心放置即可。

## D

其实就是模拟辗转相除法，辗转相除法会除到其中一个数为0为止，显然相比题意多减了一次。所以辗转相除法同时计数后，对计数减掉1即可。

## E

采用类似多重背包的优化思路，把每个物品取1-N种，变成取 $lgK$ 种不同的物品，每个物品 $j$ 价值为 $A_i2^j$ 

这样总复杂度为 $NKlgK$ ，足以通过此题。

## F

容斥组合计数题。

设 $H(w,h)$ 为所有方块都在 $w\times h$ 范围内的组合数， $G(w,h)$ 为所有方块都在 $w\times h$ 范围内，且宽度不低于 $w$ 的组合数，有：

$$
H(w,h) = {w*h \choose k}
\\
G(w,h) = H(w,h) - G(w-1,h)*2 - G(w-2,h)*3 - ...
$$

该公式的后面部分可以使用二阶前缀和 $O(1)$ 迭代并计算。

类似的，设 $F(w,h)$ 表示所有方块都在 $w\times h$ 范围内，且宽度不低于 $w$ ，高度不低于 $h$ 的组合数，有：

$$
F(w,h) = G(w,h) - F(w,h-1)*2 - F(w, h-2)*3 - ...
$$

同样采用二阶前缀和完成。 然后 $\frac{\sum F(w,h)*w*h}{W*H \choose K}$ 即为答案。

另一种思路，直接容斥：

$$
G(w,h) = H(w,h) - H(w-1,h)*2 + H(w-2,h) \\
F(w,h) = G(w,h) - G(w,h-1)*2 + G(w,h-2) 
$$

## G

SG函数，证明题。

首先需要知道SG函数概念及Nim问题的异或来源，然后求单个子问题的SG函数。

观察题目，猜测存在循环节，观察 $L=3, R=5$ 规律如下：

```
0,0,0,1,1,1,2,2,0,0,0,1,1,1,2,2 ……
```

注意到最开始一定是 $L$ 个0，之后必然连续 $R$ 个非0 （从第一个0可以到达的区域开始，到最后一个0可以到达的区域结束），因为 $R\ge L$ ，显然 $R$ 个非0之后下一个又必须是0（从之前的0无法到达该状态），且刚好连续 $L$ 个0 ，之后再是 $R$ 个非0，如此循环。

然后看具体的SG值，显然在开始的 $L$ 个0之后，是 $L$ 个1，接下来只要不不超过 $L+R$ ，就是按顺序 $L$ 个2， $L$ 个3 ，以此类推…… 因为之前的值全部都可以到达该值。 对下一个循环节来说，显然上一个1能到达的位置刚好在 $2L+R$ 结束， 上一个2 能到达的位置刚好在 $3L+R$ 结束，因此上一个循环节的非0数对下一个循环节也没有贡献。

至此，规律找到，整体以 $L+R$ 为循环节， 每个循环节内部每 $L$ 个SG值加1。反方向推导公式：

$$
SG(x) = \lfloor\frac{v \bmod (L+R)}{L}\rfloor
$$

根据Nim定理，对所有 $A_i$ 求出 $SG(A_i)$ 并全部异或，结果非0则先手必胜，结果为0则后手必胜。

## Ex

先考虑如何计算组合数。

2j<=i：无需剔除，直接累加；F[i] += F[i-j]

过1/3的：剔除一次 F[i] += F[i-j] - F[i-2j]

过1/4的：剔除一次，补回两次 F[i] += F[i-j] - F[i-2j]+F[i-3j] ...

以此类推

反过来想贡献，对于i-j -> i， 看j的每个因子奇偶性，+奇因子个数，-偶因子个数。可预处理差异贡献，可在 $O(NlgN)$ 时间内预处理完成。

然后采用倍增卷积法，在 $O(Nlg^2N)$ 时间完成

> 倍增卷积法怎么做忘记了。。回头补充。

