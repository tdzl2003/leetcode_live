# 子矩形查询

[题目链接](https://leetcode.cn/problems/subrectangle-queries/)

[代码链接](https://leetcode.cn/submissions/detail/438462433/)

因为题目的操作次数很少，记录操作历史 倒查即可通过此题，复杂度 $O(q^2)$ 

采用动态四叉树维护，当一个区间被完整设置成某个值时，可以砍掉这个区间的所有子树。这样可以证明复杂度为 $O(q(\lg{rows} + \lg{cols}))$ 

怎么证明两个lg之间不是乘法呢？

因为当区间可以被完整设置成某个值时，我们可以 $O(1)$ 快速砍掉子树，所以我们仅需要考虑表达每个矩形所需要的节点数，不需要考虑每个矩形对后续矩形的影响。

考虑四叉树的每一个节点，分为四种情况：

* 和矩形完全不相交，无需考虑。
* 被矩形完整包含，仅需整体考虑，不再需要考虑子树。
* 完整包含矩形。从根节点到该节点的路径上仅需考虑一个分支。
* 和矩形相交，但互相没有包含关系，需要继续细分。那么，该块一定包含了矩形的至少一条边。

换言之，持续细分的四叉树节点仅发生在矩形的边上，那么总细分次数不超过 四条边各自细分的次数总和，即为 $2(\lg{rows} + \lg{cols})$ 。考虑由于细分产生的节点数量，必定也不超过 $8(\lg{rows} + \lg{cols})$ 。